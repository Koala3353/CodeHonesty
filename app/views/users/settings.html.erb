<% content_for(:title) { "Settings - Hackatime" } %>

<div class="max-w-3xl mx-auto">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Settings</h1>

  <!-- Profile Settings -->
  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Profile</h2>
    
    <%= form_with model: @user, url: update_users_path, method: :patch, class: "space-y-4" do |f| %>
      <div>
        <%= f.label :username, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :username, class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
        <p class="mt-1 text-sm text-gray-500">Your public username. Can only contain letters, numbers, underscores, and dashes.</p>
      </div>

      <div>
        <%= f.label :display_name, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :display_name, class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
      </div>

      <div>
        <%= f.label :timezone, class: "block text-sm font-medium text-gray-700" %>
        <%= f.time_zone_select :timezone, nil, {}, class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
        <p class="mt-1 text-sm text-gray-500">Used for daily statistics calculations.</p>
      </div>

      <div>
        <%= f.submit "Save Changes", class: "inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <!-- API Keys -->
  <div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">API Keys</h2>
    <p class="text-sm text-gray-500 mb-4">
      Use these API keys to configure your editor plugins. Keep them secret!
    </p>

    <% if @api_keys.present? %>
      <ul class="divide-y divide-gray-200 mb-4">
        <% @api_keys.each do |api_key| %>
          <li class="py-4 flex justify-between items-center">
            <div>
              <p class="font-medium text-gray-900"><%= api_key.name || "Unnamed Key" %></p>
              <p class="text-sm text-gray-500 font-mono"><%= api_key.token %></p>
              <p class="text-xs text-gray-400">Created <%= time_ago_in_words(api_key.created_at) %> ago</p>
            </div>
            <%= button_to "Delete", destroy_api_key_users_path(id: api_key.id), method: :delete, data: { confirm: "Are you sure you want to delete this API key?" }, class: "text-red-600 hover:text-red-800 text-sm" %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-gray-500 mb-4">You don't have any API keys yet.</p>
    <% end %>

    <%= form_with url: create_api_key_users_path, method: :post, class: "flex items-end space-x-4" do |f| %>
      <div class="flex-1">
        <%= f.label :name, "Key Name", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :name, placeholder: "e.g., VS Code on MacBook", class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
      </div>
      <%= f.submit "Create API Key", class: "inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 cursor-pointer" %>
    <% end %>
  </div>

  <!-- Setup Instructions -->
  <div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Editor Setup</h2>
    <p class="text-gray-600 mb-4">
      To start tracking your coding time, install the WakaTime plugin for your editor and configure it with Hackatime.
    </p>
    
    <ol class="list-decimal list-inside space-y-3 text-gray-600">
      <li>Install the WakaTime plugin for your editor from <a href="https://wakatime.com/plugins" class="text-indigo-600 hover:underline" target="_blank">wakatime.com/plugins</a></li>
      <li>When prompted for an API key, use one of your keys from above</li>
      <li>
        Configure the plugin to use Hackatime's API URL:
        <code class="bg-gray-100 px-2 py-1 rounded text-sm block mt-1"><%= request.base_url %>/api/hackatime/v1</code>
      </li>
      <li>Start coding! Your activity will appear on your dashboard.</li>
    </ol>
  </div>
</div>