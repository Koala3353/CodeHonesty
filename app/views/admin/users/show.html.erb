<% content_for(:title) { "#{@user.display_username} - Admin - Hackatime" } %>

<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold text-white"><%= @user.display_username %></h1>
  <div class="space-x-4">
    <%= link_to "Edit", edit_admin_user_path(@user), class: "bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded" %>
    <%= link_to "Back to Users", admin_users_path, class: "text-gray-400 hover:text-gray-300" %>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
  <div class="bg-gray-800 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-white mb-4">Profile</h2>
    <dl class="space-y-3">
      <div class="flex justify-between">
        <dt class="text-gray-400">Username</dt>
        <dd class="text-white"><%= @user.username || "Not set" %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Email</dt>
        <dd class="text-white"><%= @user.email || "Not set" %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Slack UID</dt>
        <dd class="text-white font-mono text-sm"><%= @user.slack_uid || "Not linked" %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">GitHub UID</dt>
        <dd class="text-white font-mono text-sm"><%= @user.github_uid || "Not linked" %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Timezone</dt>
        <dd class="text-white"><%= @user.timezone %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Created</dt>
        <dd class="text-white"><%= @user.created_at.strftime("%Y-%m-%d %H:%M:%S") %></dd>
      </div>
    </dl>
  </div>

  <div class="bg-gray-800 rounded-lg p-6">
    <h2 class="text-lg font-semibold text-white mb-4">Statistics</h2>
    <dl class="space-y-3">
      <div class="flex justify-between">
        <dt class="text-gray-400">Total Heartbeats</dt>
        <dd class="text-white font-mono"><%= number_with_delimiter(@heartbeats_count) %></dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Trust Level</dt>
        <dd>
          <span class="px-2 py-1 rounded text-xs font-medium
            <%= case @user.trust_level
                when 'green' then 'bg-green-600 text-white'
                when 'yellow' then 'bg-yellow-600 text-white'
                when 'red' then 'bg-red-600 text-white'
                else 'bg-blue-600 text-white'
                end %>">
            <%= @user.trust_level %>
          </span>
        </dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-gray-400">Admin Level</dt>
        <dd class="text-white"><%= @user.admin_level %></dd>
      </div>
    </dl>
  </div>
</div>

<!-- Trust Level Actions -->
<div class="bg-gray-800 rounded-lg p-6 mb-6">
  <h2 class="text-lg font-semibold text-white mb-4">Moderation</h2>
  <%= form_with url: convict_admin_user_path(@user), method: :post, class: "space-y-4" do |f| %>
    <div>
      <%= f.label :trust_level, "Change Trust Level", class: "block text-sm font-medium text-gray-300" %>
      <%= f.select :trust_level, User.trust_levels.keys, {}, class: "mt-1 block w-full px-3 py-2 border border-gray-600 bg-gray-700 text-white rounded-md" %>
    </div>
    <div>
      <%= f.label :reason, "Reason", class: "block text-sm font-medium text-gray-300" %>
      <%= f.text_area :reason, rows: 2, class: "mt-1 block w-full px-3 py-2 border border-gray-600 bg-gray-700 text-white rounded-md" %>
    </div>
    <%= f.submit "Update Trust Level", class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded cursor-pointer" %>
  <% end %>
</div>

<!-- Recent Heartbeats -->
<div class="bg-gray-800 rounded-lg p-6">
  <h2 class="text-lg font-semibold text-white mb-4">Recent Heartbeats</h2>
  <% if @recent_heartbeats.present? %>
    <table class="min-w-full divide-y divide-gray-700">
      <thead>
        <tr>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Time</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Project</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Language</th>
          <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Editor</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700">
        <% @recent_heartbeats.each do |hb| %>
          <tr>
            <td class="px-4 py-2 text-gray-300 text-sm"><%= Time.at(hb.time).strftime("%Y-%m-%d %H:%M:%S") %></td>
            <td class="px-4 py-2 text-white"><%= hb.project %></td>
            <td class="px-4 py-2 text-gray-300"><%= hb.language %></td>
            <td class="px-4 py-2 text-gray-300"><%= hb.editor %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="text-gray-400">No heartbeats recorded yet.</p>
  <% end %>
</div>